/*! chartstack 2014-04-18 */

!function(a){function b(){console.log("Error!",arguments)}function c(a,b){return a=typeof a,b?a==b:"undefined"!=a}function d(a,b,d){var e;if(!a)return 0;if(d=d?d:a,c(a.length)){for(e=0;e<a.length;e++)if(b.call(d,a[e],e,a)===!1)return 0}else for(e in a)if(a.hasOwnProperty(e)&&b.call(d,a[e],e,a)===!1)return 0;return 1}function e(a,b){return d(b,function(b,c){a[c]=b}),a}function f(){return a.chartstack=v,this}function g(a){u?a():x.push(a)}function h(){if(w.defaults.library)w.library=w.defaults.library;else for(var b in w.libraries)if(b in window){w.library=b;break}if(!w.library)throw new Error("No charting library located.");w.parseDOM(),u=!0,w.moment=a.moment||!1,d(x,function(a){a()})}function i(a){var b,c=a.nodeName?a:document.querySelector(a);if(c)return d(w.charts,function(a){return c==a.el?(b=a,!1):void 0}),b;throw"That element doesn't exist on the page."}function j(a,b){w.is(b,"function")?p[a]=b:d(b,function(b,c){p[a]||(p[a]={}),p[a][c]=b})}function k(){var a,b=[];d(w.libraries,function(a){for(var c in a)-1==b.indexOf(c)&&b.push(c)}),a=document.querySelectorAll(b.join(",")),d(a,function(a){a.getAttribute("dataset")&&new r(a)})}function l(a){for(var b,c={},d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=function(a){return decodeURIComponent(a.replace(d," "))},g=a.split("?")[1];b=e.exec(g);)c[f(b[1])]=f(b[2]);return c}function m(a){var b=[];for(var c in a)if(a[c]){var d=a[c];"[object String]"!==Object.prototype.toString.call(d)&&(d=JSON.stringify(d)),d=encodeURIComponent(d),b.push(c+"="+d)}return"?"+b.join("&")}function n(a,b){var c,d=function(){var a;if(window.ActiveXObject)try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){console.warn(b.message),a=null}else a=new XMLHttpRequest;return a};c=d(),c.onreadystatechange=function(){4===c.readyState&&b(c.responseText)},c.open("GET",a,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send()}function o(a,b,c){for(var d="ChartstackJSONPCallback"+(new Date).getTime();d in window;)d+="a";var e=!1;window[d]=function(a){e=!0,b&&a&&b(a),window[d]=void 0},a=a+"&jsonp="+d;var f=document.createElement("script");f.id="chartstack-jsonp",f.src=a,document.getElementsByTagName("head")[0].appendChild(f),f.onreadystatechange=function(){e===!1&&"loaded"===this.readyState&&(e=!0,c&&c())},f.onerror=function(){e===!1&&(e=!0,c&&c())}}var p,q,r,s,t,u,v=a.chartstack,w=a.chartstack={},x=[];w.adapters=p={},w.charts=q=[],w.transformers=t={json:function(a){return"string"==typeof a?JSON.parse(a):a}},w.defaults=e({labels:!0},w.defaults||{}),s=w.Events={on:function(a,b){this.listeners||(this.listeners={});var c=this.listeners[a]||(this.listeners[a]=[]);return c.push({callback:b}),this},off:function(a,b){if(!a&&!b)return this.listeners=void 0,delete this.listeners,this;for(var c=this.listeners[a]||[],d=c.length;d--;)b&&b==c[d].callback&&this.listeners[a].splice(d,1),b&&0!==c.length||(this.listeners[a]=void 0,delete this.listeners[a]);return this},trigger:function(a){if(!this.listeners)return this;for(var b=Array.prototype.slice.call(arguments,1),c=this.listeners[a]||[],d=0;d<c.length;d++)c[d].callback.apply(this,b);return this}},e(w,s),w.DataResource=function(a){if("string"==typeof a)a.match(/^({|\[)/)?this.response=JSON.parse(a):this.url=a;else for(var b in a)this[b]=a[b];this.configure()},w.DataResource.prototype={configure:function(){return void 0!==this.url&&-1!==this.url.indexOf("?")&&void 0==this.params&&(this.params=w.parseParams(this.url),this.url=this.url.split("?")[0]),this},get:function(a){return this.params[a]||null},set:function(a){for(var b in a)this.params[b]=a[b];return this}},e(w.DataResource.prototype,s),w.Dataset=function(a){var b=[],c=a||{};c instanceof Array?d(c,function(a){b.push(new w.DataResource(a))}):b.push(new w.DataResource(c)),this.resources=b},w.Dataset.prototype={fetch:function(){var a=this,b=0;a.data=[],a.responses=[];var c=function(c,d){a.responses[d]=JSON.parse(c),b++,b==a.resources.length&&a.transform()},e=function(){return!1};return d(a.resources,function(a,b){if(a.url){var d=a.url+m(a.params),f=function(a){c(a,b)};w.getAjax(d,f,e)}else e()}),a},transform:function(){var a=this;return d(a.resources,function(b,c){var d=b.adapter,e=a.responses[c];a.data[c]=p[d].call(b,e)}),a.trigger("complete",a.data[0]),a},at:function(a){return this.resources[a]||null}},e(w.Dataset.prototype,s),w.Visualization=function(a){var c=this;e(c,a),c.chartOptions=c.chartOptions||{},c.chartOptions.width=c.chartOptions.width||c.el.offsetWidth,c.on("error",function(){b.apply(this,arguments)}),c.on("update",function(){c.update.apply(this,arguments)}),this.initialize()},w.Visualization.prototype={initialize:function(){},render:function(){},update:function(){},remove:function(){}},e(w.Visualization.prototype,s),w.libraries={},w.Visualization.register=function(a,b){w.libraries[a]=w.libraries[a]||{};for(var c in b)w.libraries[a][c]=b[c]},w.Visualization.extend=function(a,b){var c,d=this;c=a&&a.hasOwnProperty("constructor")?a.constructor:function(){return d.apply(this,arguments)},e(c,d,b);var f=function(){this.constructor=c};return f.prototype=d.prototype,c.prototype=new f,a&&e(c.prototype,a),c.__super__=d.prototype,c},w.Chart=r=function(a){function b(){function a(a,b){-1!==k.indexOf(a)?g[a]=b:-1!==j.indexOf(a)?h[a]=b:f.chartOptions[a]=b}var b,i,j,k,l;b=function(){f.el=h,h.chartType=f.el.nodeName.toLocaleLowerCase(),f.el.style.display="block",f.style={display:"inline-block"}},i=function(){},d(w.defaults,function(a,b){f[b]=a}),"nodeType"in h?b():i(),k=["adapter","dataset","dataformat","dateformat"],j=["library"],l=["title","labels","height","width","isStacked"],d(j.concat(k,l),function(b){var d,e;c(b,"object")&&(e=b[1],b=b[0]),d=h.nodeType?h.getAttribute(b):h[b],d&&("false"==d||"0"==d||"off"==d?d=!1:("true"==d||"1"==d||"on"==d)&&(d=!0),e?a(e,d):a(b,d))}),h.library||(h.chartType in w.libraries[w.library]||h.view instanceof w.Visualization?h.library=w.library:d(w.libraries,function(a,b){d(a,function(a,c){h.chartType==c&&(h.library=b)})})),e.view=h.view instanceof w.Visualization?h.view:new w.libraries[h.library][h.chartType](f),h.dataset instanceof w.Dataset?e.dataset=h.dataset:"string"==typeof g.dataset&&(e.dataset=new w.Dataset(g.dataset.replace(/(\r\n|\n|\r|\ )/g,"")),e.dataset.resources[0].adapter=g.adapter||!1,e.dataset.resources[0].dataformat=g.dataformat||"json",e.dataset.resources[0].dateformat=g.dateformat||!1),e.dataset.on("complete",function(a){e.view.data=this.data,e.view.trigger("update",a)}),e.dataset.fetch()}var e=this,f={chartOptions:{}},g={},h=a||{};w.charts.push(e),b()},r.prototype={show:function(){return this.trigger("show"),this},hide:function(){return this.trigger("hide"),this},draw:function(){return this.trigger("draw"),this},fetch:function(){return this.dataset.fetch(),this}},e(r.prototype,s),e(w,{is:c,each:d,extend:e,noConflict:f,ready:g,get:i,addAdapter:j,parseDOM:k,parseParams:l,buildQueryString:m,getAjax:n,getJSONP:o}),window.google?(google.load("visualization","1.0",{packages:["corechart","table"]}),google.setOnLoadCallback(h)):document.addEventListener("DOMContentLoaded",h)}(this),function(a){function b(){var a=[],b=function(){var c=arguments[0],e=Array.prototype.slice.call(arguments,1),f=e.pop();return 0===e.length&&(c instanceof Array?e=c:"object"==typeof c&&e.push(c)),d(e,function(g){return""==f&&"number"==typeof g?a.push(g):g[f]||0===g[f]||void 0!==g[f]?a.push(null===g[f]?"":g[f]):c[g]?c[g]instanceof Array?void d(c[g],function(a,d){var h=[c[g]].concat(c[g][d]).concat(e.slice(1)).concat(f);return b.apply(this,h)}):c[g][f]?a.push(c[g][f]):b.apply(this,[c[g]].concat(e.splice(1)).concat(f)):b.apply(this,[g].concat(e.splice(1)).concat(f))}),a.length>0?a:void 0};return b.apply(this,arguments)}var c,d=chartstack.each;a.dataform=function(a,b){this.build(a,b)},c=a.dataform.prototype,c.build=function(a,c){var e,f=this;return e=""==c.root?[[a]]:b.apply(f,[a].concat(c.root.split(" -> "))),f.root=e[0],f.map=c,f.table=[],f.series=[],f.raw=a,f.cols=function(){var a,b,c={fixed:[]};return b=f.map.each.value.split(" -> "),a=f.map.each.index?f.map.each.index.split(" -> "):f.map.each.value.split(" -> "),c.fixed.push(a[a.length-1]),f.map.each.label?c.cells=f.map.each.label.split(" -> "):c.fixed.push(b[b.length-1]),c}(),f.rows={index:f.map.each.index?f.map.each.index.split(" -> "):["result"],cells:f.map.each.value?f.map.each.value.split(" -> "):[]},f.order=function(){var a={};return f.map.sort&&(a.rows=f.map.sort.index||"asc",a.cols=f.map.sort.label||"desc"),a}(),f.order.rows.length>0&&f.root instanceof Array&&f.root.sort(function(a,c){var d=b.apply(f,[a].concat(f.rows.index)),e=b.apply(f,[c].concat(f.rows.index));return"asc"==f.order.rows?d>e?1:e>d?-1:0:d>e?-1:e>d?1:0}),function(){f.cols.fixed&&""==f.cols.fixed[f.cols.fixed.length-1]?(f.cols.label=f.cols.fixed[f.cols.fixed.length-1],fixed=f.cols.fixed,fixed.splice(fixed.length-1,1)):(f.cols.label=fixed=f.cols.fixed[0],fixed=f.cols.fixed);var a=f.cols.cells?b.apply(f,[f.root[0]].concat(f.cols.cells)):[],c=fixed.concat(a);c.length>1&&c.splice(0,1),d(c,function(a){f.series.push({key:a,values:[]})})}(),f.root instanceof Array||"object"==typeof f.root?d(f.root,function(a){var c=b.apply(f,[a].concat(f.rows.index)),e=b.apply(f,[a].concat(f.rows.cells));c.length>1?d(c,function(a,b){var c={};c[f.cols.label]=a,c.value=e[b],f.series[0].values.push(c)}):d(e,function(a,b){var d={};d[f.cols.label]=c[0],d.value=a,f.series[b].values.push(d)})}):!function(){var a={};a[f.cols.label]="result",a.value=f.root,f.series[0].values.push(a)}(),f.order.cols.length>0&&(f.series=f.series.sort(function(a,b){var c=0,e=0;return d(a.values,function(a){c+=a.value}),d(b.values,function(a){e+=a.value}),"asc"==f.order.cols?c-e:e-c})),f.table=[],f.table.push([f.cols.label]),d(f.series[0].values,function(a){f.table.push([a[f.cols.label]])}),d(f.series,function(a){f.table[0].push(a.key),d(a.values,function(a,b){f.table[b+1].push(a.value)})}),this}}(chartstack),function(a){var b=a.each;a.addAdapter("keen-io",function(c){var d,e,f=this,g=f.map||!1;if(!g)if(g={root:"result",each:{},sort:{index:"asc",label:"desc"}},c.result instanceof Array){if(void 0!==c.result[0].value)if(c.result[0].value instanceof Array){g.each.value="value -> result";for(var h in c.result[0].value[0])if("result"!==h){g.each.label="value -> "+h;break}}else g.each.value="value";if(c.result[0].timeframe&&(g.each.index="timeframe -> start"),c.result[0].result){g.each.value="result";for(var h in c.result[0])if("result"!==h){g.each.index=h;break}}"number"==typeof c.result[0]&&(g.root="",g.each.index="steps -> event_collection",g.each.value="result -> ")}else g.each.value="result";return d=new a.dataform(c,g),e=d.table,chartstack.moment&&b(e,function(a,c){b(a,function(a,b){0==b&&chartstack.moment(a).isValid()&&(e[c][b]=f.dateformat?chartstack.moment(a).format(f.dateformat):new Date(a))})}),e})}(chartstack),function(a){a.each,a.extend;a.Keen=a.Keen||{},a.Keen.Metric=a.Visualization.extend({initialize:function(){var a=document.createElement("style");a.type="text/css",a.innerHTML=".cs-widget {\n          background: #49c5b1;\n          border-radius: 4px;\n          color: #fff;\n          font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;\n          margin: 0 auto;\n          padding: 10px 0;\n          text-align: center;\n        }\n        .cs-widget-title {\n          display: block;\n          font-size: 84px;\n          font-weight: 700;\n          line-height: 84px;\n        }\n        .cs-widget-subtitle {\n          display: block;\n          font-size: 24px;\n          font-weight: 200;\n        }",document.body.appendChild(a),this.render()},update:function(){this.el.innerHTML='<div class="cs-widget cs-number" style="width:'+parseInt(this.chartOptions.width)+'px;"><span class="cs-widget-title">'+this.data[0][1][1]+'</span><span class="cs-widget-subtitle">'+(this.chartOptions.title||"Result")+"</span></div>"}}),a.Visualization.register("keen-io",{metric:a.Keen.Metric})}(chartstack),function(a){var b=(a.each,a.extend);a.GoogleCharts=a.GoogleCharts||{},a.GoogleCharts.AreaChart=a.Visualization.extend({initialize:function(){this.render()},render:function(){this._chart=this._chart||new google.visualization.AreaChart(this.el)},update:function(){var a=google.visualization.arrayToDataTable(this.data[0]),c=b(this.chartOptions,{title:this.chartOptions.title||"",height:parseInt(this.chartOptions.height),width:parseInt(this.chartOptions.width)});this._chart.draw(a,c)}}),a.GoogleCharts.BarChart=a.Visualization.extend({initialize:function(){this.render()},render:function(){this._chart=this._chart||new google.visualization.BarChart(this.el)},update:function(){var a=google.visualization.arrayToDataTable(this.data[0]),c=b(this.chartOptions,{title:this.chartOptions.title||"",height:parseInt(this.chartOptions.height),width:parseInt(this.chartOptions.width)});this._chart.draw(a,c)}}),a.GoogleCharts.ColumnChart=a.Visualization.extend({initialize:function(){this.render()},render:function(){this._chart=this._chart||new google.visualization.ColumnChart(this.el)},update:function(){var a=google.visualization.arrayToDataTable(this.data[0]),c=b(this.chartOptions,{title:this.chartOptions.title||"",height:parseInt(this.chartOptions.height),width:parseInt(this.chartOptions.width)});this._chart.draw(a,c)}}),a.GoogleCharts.LineChart=a.Visualization.extend({initialize:function(){this.render()},render:function(){this._chart=this._chart||new google.visualization.LineChart(this.el)},update:function(){var a=google.visualization.arrayToDataTable(this.data[0]),c=b(this.chartOptions,{title:this.chartOptions.title||"",height:parseInt(this.chartOptions.height),width:parseInt(this.chartOptions.width)});this._chart.draw(a,c)}}),a.GoogleCharts.PieChart=a.Visualization.extend({initialize:function(){this.render()},render:function(){this._chart=this._chart||new google.visualization.PieChart(this.el)},update:function(){var a=google.visualization.arrayToDataTable(this.data[0]),c=b(this.chartOptions,{title:this.chartOptions.title||"",height:parseInt(this.chartOptions.height),width:parseInt(this.chartOptions.width)});this._chart.draw(a,c)}}),a.GoogleCharts.DataTable=a.Visualization.extend({initialize:function(){this.render()},render:function(){this._chart=this._chart||new google.visualization.Table(this.el)},update:function(){var a=google.visualization.arrayToDataTable(this.data[0]);this._chart.draw(a,this.chartOptions)}}),a.Visualization.register("google",{areachart:a.GoogleCharts.AreaChart,barchart:a.GoogleCharts.BarChart,columnchart:a.GoogleCharts.ColumnChart,linechart:a.GoogleCharts.LineChart,piechart:a.GoogleCharts.PieChart,datatable:a.GoogleCharts.DataTable})}(chartstack);
//# sourceMappingURL=chartstack.min.map