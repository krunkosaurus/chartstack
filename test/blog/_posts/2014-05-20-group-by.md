---
layout: post
title: Advanced charts and the need for Chartstack.Model.groupBy()
---

If you've read the Chartstack [Unified Chart Data Format Wiki page](https://github.com/keenlabs/chartstack/wiki/Unified-Chart-Data-Format) you'll note that all chart data can universally be understood as time series data. Every chart's data can generally be expressed in one of the four main time series types (which are all subsets and supersets of each other): Metric, Multi Metric, Time Series, and Multi Time Series. These data formats cover virtually all popular chart types from pie, bar, line, scatter, multi-bar/line, and so on.

For brevity, here is what Multi Time Series data looks like:

{% highlight js %}
{
  "data": [
    ["Year", "Sales", "Expenses"],
    ["2004",  1000,      400],
    ["2005",  1170,      460],
    ["2006",  660,       1120],
    ["2007",  1030,      540]
  ],
   "extras": {}
]
{% endhighlight %}
<center>Figure 1: _Multi Time Series data example_</center>

To repeat, all chart data, whether the end product is a pie chart or multi-scatter chart can be represented using this data schema or subset of this scheme.

This worked for every chart type we encountered until we found outselves viewing a Sunburst chart (also known as a multi-level pie chart):

[![Sunburst chart](/public/blog_assets/sunburst.gif)](/public/blog_assets/sunburst.gif)

This chart is amazing for visualzing complex data. With one diagram you can see, in multiple levels, various information about the last Titanic voyage:

* **Level 1:** What percentage of all people on the ship was: First, second, third class, vs crew.
* **Level 2:** What percentage of each class/crew type was male vs female.
* **Level 3:** What percentage of each class's gender were adult vs children.
* **Level 4:** What percentage of each adult and child from each gender and class survived.

There is a huge amount of data easily expressed and understood in one great view!  Something that Chartstack definitely wants to easily support. The data from this chart could have also have been represented as a simple pie chart that allowed the user to double click each pie slice to "drill down" to the next view.

There are two valuable insights we learned from this chart:

**Chart data doesn't neccesarily need to be a direct representation of the chart**. For example, what if the user wanted to swap level 1 and 3 and start with percent of children vs adults who survival on the Titanic? What if we wanted to support drill down data in a simple pie chart to advance to the next evels? The reality is that the chart data represented here is all that is needed in any of these situations and another round trip to the server isn't needed to fetch data in a different or modified order, **the charting library should be able to understand the data and support modifying, rearranging, and grouping it, itself.**

Here's how the Starburst data could be represented:

{% highlight js %}
{
  "data": [
    ["Class",  "Gender", "Age",    "Survived", "Count"],
    ["First",  "male",   "adult"], "yes",      "7"],
    ["First",  "male",   "adult"], "no",       "38"],
    ["First",  "male",   "child"], "yes",      "0"],
    ["First",  "male",   "child"], "no",       "0"],
    ["First",  "female", "adult"], "yes",      "7"],
    ["First",  "female", "adult"], "no",       "38"],
    ["First",  "female", "child"], "yes",      "0"],
    ["First",  "female", "child"], "no",       "0"],
    ["Second", "male",   "adult"], "yes",      "7"],
    ["Second", "male",   "adult"], "no",       "38"],
    ["Second", "male",   "child"], "yes",      "0"],
    ["Second", "male",   "child"], "no",       "0"],
    ["Second", "female", "adult"], "yes",      "7"],
    ["Second", "female", "adult"], "no",       "38"],
    ["Second", "female", "child"], "yes",      "0"],
    ["Second", "female", "child"], "no",       "0"],
    ["Third",  "male",   "adult"], "yes",      "7"],
    ["Third",  "male",   "adult"], "no",       "38"],
    ["Third",  "male",   "child"], "yes",      "0"],
    ["Third",  "male",   "child"], "no",       "0"],
    ["Third",  "female", "adult"], "yes",      "7"],
    ["Third",  "female", "adult"], "no",       "38"],
    ["Third",  "female", "child"], "yes",      "0"],
    ["Third",  "female", "child"], "no",       "0"],
    ["Crew",   "male",   "adult"], "yes",      "7"],
    ["Crew",   "male",   "adult"], "no",       "38"],
    ["Crew",   "male",   "child"], "yes",      "0"],
    ["Crew",   "male",   "child"], "no",       "0"],
    ["Crew",   "female", "adult"], "yes",      "7"],
    ["Crew",   "female", "adult"], "no",       "38"],
    ["Crew",   "female", "child"], "yes",      "0"],
    ["Crew",   "female", "child"], "no",       "0"]
  ],
   "extras": {}
]
{% endhighlight %}

Sorting out concept...

{% highlight js %}
chartstack.model.reorder(['Age', 'Gender', 'Class', 'Survived', 'Count']);
{% endhighlight %}

or

{% highlight js %}
chartstack.model.reorder([3,2,1,4,5]);
{% endhighlight %}

and then

{% highlight js %}
chartstack.model.groupBy(['Age', 'Gender', 'Class', 'Survived']);
{% endhighlight %}

To be continued...
