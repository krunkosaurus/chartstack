/*! chartstack 2014-04-07 */

!function(a){function b(a,b){return a=typeof a,b?a==b:"undefined"!=a}function c(a,c,d){var e;if(!a)return 0;if(d=d?d:a,b(a.length)){for(e=0;e<a.length;e++)if(c.call(d,a[e],e,a)===!1)return 0}else for(e in a)if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1)return 0;return 1}function d(a,b){return c(b,function(b,c){a[c]=b}),a}function e(){return a.chartstack=v,this}function f(a){u?a():x.push(a)}function g(){if(w.defaults.library)w.library=w.defaults.library;else{if(c(Object.keys(w.renderers),function(a){return a in window?(w.library=a,!1):void 0}),!w.library)throw new Error("No charting library located.");w.parse(),u=!0,c(x,function(a){a()})}}function h(){var a=document.querySelectorAll("piechart,barchart,linechart");c(a,function(a){a.getAttribute("datasource")&&new r(a)})}function i(a,b){var c,d=function(){var a;if(window.ActiveXObject)try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){console.warn(b.message),a=null}else a=new XMLHttpRequest;return a};c=d(),c.onreadystatechange=function(){4===c.readyState&&b(c.responseText)},c.open("GET",a,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send()}function j(a){var b,d=a.nodeName?a:document.querySelector(a);if(d)return c(w.charts,function(a){return d==a.el?(b=a,!1):void 0}),b;throw"That element doesn't exist on the page."}function k(a,b){w.is(b,"function")?o[a]=b:c(b,function(b,c){o[a]||(o[a]={}),o[a][c]=b})}function l(a,b){c(b,function(b,c){p[a]||(p[a]={}),p[a][c]=b})}function m(a){var b=(a.name,a.namespace);w.addRenderer(b,a.render),w.addAdapter(b,a.adapter)}function n(a,b){t[a]=b}var o,p,q,r,s,t,u,v=a.chartstack,w=a.chartstack={},x=[];w.adapters=o={},w.renderers=p={},w.charts=q=[],w.transformers=t={json:function(a){return"string"==typeof a?JSON.parse(a):a}},d(w,{noConflict:e,parse:h,is:b,each:c,extend:d,getAjax:i,ready:f,get:j,addAdapter:k,addRenderer:l,addRenderSet:m,addtransformer:n}),w.defaults={labels:!0},w.DataAdapter=s=function(){},w.Chart=r=function(a){function e(){var d,e,f;d=function(){g.el=a,g.chartType=g.el.nodeName.toLocaleLowerCase(),g.el.style.display="inline-block"},e=function(){g.el=a.el,g.chartType=a.chartType},c(w.defaults,function(a,b){g[b]=a}),"nodeType"in a?d():e(),c([["provider","domain"],"datasource","dataformat","library","labels","width","height","title","titleTextColor","legendColor","colors","pieSliceBorderColor","pieSliceTextColor","backgroundColor","customOptions","formatRowLabel"],function(c){var d,e;b(c,"object")&&(e=c[1],c=c[0]),d=a.nodeType?a.getAttribute(c):a[c],d&&("false"==d||"0"==d||"off"==d?d=!1:("true"==d||"1"==d||"on"==d)&&(d=!0),e?g[e]=d:g[c]=d)}),g.library||(g.library=w.library),g.dataformat||(g.dataformat="json"),p[g.library]&&p[g.library].init&&p[g.library].init(g),"string"==typeof g.datasource&&(g.datasource.match(/^({|\[)/)?g.datasource=JSON.parse(g.datasource):(f=g.datasource.match(/\/\/(.*?)\//),f&&(g.domain=f[1])))}function f(a){function b(b){if(!(g.dataformat in t))throw new Error("Transformer for datatype missing: "+g.dataformat);b=t[g.dataformat](b),o[g.domain]&&o[g.domain][g.chartType]&&(b=o[g.domain][g.chartType].call(new s,b)),g.formatRowLabel&&w.each(b.data,function(a,c){0!=c&&(b.data[c][0]=g.formatRowLabel(a[0]))}),b=w.is(o[g.library],"function")?o[g.library].call(new s,b):o[g.library][g.chartType].call(new s,b),a(b)}"string"==typeof g.datasource?w.getAjax(g.datasource,b):b(g.datasource)}var g=this;w.charts.push(this),e(),f(function(a){var b=w.renderers[g.library];if(!b)throw"Renderer for "+g.library+" is missing.";if(!b[g.chartType])throw"Renderer for "+g.library+":"+g.chartType+" is missing.";b[g.chartType](g,a)}),d(this,{show:function(){this.el.style.display="none"},hide:function(){this.el.style.display="block"},render:function(){},fetch:function(a){a||(a=function(){}),f(a)}})},window.google?(google.load("visualization","1.0",{packages:["corechart"]}),google.setOnLoadCallback(g)):document.addEventListener("DOMContentLoaded",g)}(this),function(a){function b(){var a=[],b=function(){var c=arguments[0],e=Array.prototype.slice.call(arguments,1),f=e.pop();return 0===e.length&&(c instanceof Array?e=c:"object"==typeof c&&e.push(c)),d(e,function(g){return g[f]||0==g[f]||void 0!==g[f]?a.push(null===g[f]?"":g[f]):c[g]?c[g]instanceof Array?void d(c[g],function(a,d){var h=[c[g]].concat(c[g][d]).concat(e.slice(1)).concat(f);return b.apply(this,h)}):c[g][f]?a.push(c[g][f]):b.apply(this,[c[g]].concat(e.splice(1)).concat(f)):b.apply(this,[g].concat(e.splice(1)).concat(f))}),a.length>0?a:void 0};return b.apply(this,arguments)}var c,d=chartstack.each;a.diver=function(a,b){this.build(a,b)},c=a.diver.prototype,c.build=function(a,c){var e=this;if(e.cols={label:c.cols.label?c.cols.label.split(" -> "):!1,cells:c.cols.cells?c.cols.cells.split(" -> "):!1,fixed:c.cols.fixed?c.cols.fixed:!1},e.rows={index:c.rows.index.split(" -> "),cells:c.rows.cells.split(" -> ")},e.order={rows:c.order&&c.order.rows?c.order.rows.split(":"):!1,cols:c.order&&c.order.cols?c.order.cols.split(":"):!1},e.table=[],e.series=[],e.raw=a,e.order.rows.length>0&&a.sort(function(a,c){var d=b.apply(e,[a].concat(e.rows.index)),f=b.apply(e,[c].concat(e.rows.index));return"asc"==e.order.rows[1]?d>f?1:f>d?-1:0:d>f?-1:f>d?1:0}),function(){e.cols.label=e.cols.fixed?e.cols.fixed[0]:"series";var c=e.cols.fixed?e.cols.fixed:[],f=e.cols.cells?b.apply(e,[a[0]].concat(e.cols.cells)):[],g=c.concat(f);g.splice(0,1),d(g,function(a){e.series.push({key:a,values:[]})})}(),d(a,function(a){var c=b.apply(e,[a].concat(e.rows.index)),f=b.apply(e,[a].concat(e.rows.cells));d(f,function(a,b){var d={};d[e.cols.label]=c[0],d.value=a,e.series[b].values.push(d)})}),e.order.cols.length>0&&(e.series=e.series.sort(function(a,b){var c=0,f=0;return d(a.values,function(a){c+=a.value}),d(b.values,function(a){f+=a.value}),"asc"==e.order.cols[1]?c-f:f-c})),e.table=[],e.table.push([e.cols.label]),d(e.series[0].values,function(a){e.table.push([a[e.cols.label]])}),d(e.series,function(a){e.table[0].push(a.key),d(a.values,function(a,b){e.table[b+1].push(a.value)})}),c.cols.transform)for(var f in c.cols.transform)"all"==f?d(e.table[0],function(a,b){b>0&&(e.table[0][b]=c.cols.transform[f](e.table[0][b]))}):(f=parseInt(f),e.table[0].length>f&&(e.table[0][f]=c.cols.transform[f](e.table[0][f])));return c.rows.transform&&d(e.table,function(a,b){if(b>0)for(var d in c.rows.transform)e.table[b][d]=c.rows.transform[d](e.table[b][d])}),this},c.render=function(a){return this}}(chartstack),function(a){a.addAdapter("api.keen.io",{piechart:function(b){return b=new a.diver(b.result,{cols:{fixed:["Browser","Share"]},rows:{index:"platform",cells:"result"}}),{data:b.table,extras:{}}},barchart:function(b){return b=new a.diver(b.result,{cols:{fixed:["Date"],cells:"value -> platform"},rows:{index:"timeframe -> start",cells:"value -> result",transform:{0:function(a){return new Date(a)}}}}),{data:b.table,extras:{}}},linechart:function(b){var c;return c=b.result[0].value instanceof Array?{cols:{fixed:["Date"],cells:"value -> platform"},rows:{index:"timeframe -> start",cells:"value -> result",transform:{0:function(a){return new Date(a)}}}}:{cols:{fixed:["Date","Value"]},rows:{index:"timeframe -> start",cells:"value",transform:{0:function(a){return new Date(a)}}}},b=new a.diver(b.result,c),{data:b.table,extras:{}}}})}(chartstack),function(a){a.addRenderSet({name:"Google Charts",namespace:"google",adapter:function(a){return google.visualization.arrayToDataTable(a.data)},render:{piechart:function(b,c){var d,e,f=a.each,g=a.extend;e={title:b.title||"",width:parseInt(b.width),height:parseInt(b.height)},b.customOptions&&g(e,b.customOptions),f(["backgroundColor","pieSliceBorderColor","colors"],function(a){a in b&&(e[a]=b[a])}),"pieSliceTextColor"in b&&(e.pieSliceTextStyle={color:b.pieSliceTextColor}),"titleTextColor"in b&&(e.titleTextStyle={color:b.titleTextColor}),"legendColor"in b&&(e.legend={textStyle:{color:b.legendColor}}),d=new google.visualization.PieChart(b.el),d.draw(c,e)},barchart:function(b,c){{var d,e,f=a.each;a.extend}e={title:b.title||"",width:parseInt(b.width),height:parseInt(b.height)},f(["backgroundColor","pieSliceBorderColor","colors"],function(a){a in b&&(e[a]=b[a])}),"titleTextColor"in b&&(e.titleTextStyle={color:b.titleTextColor}),"legendColor"in b&&(e.legend={textStyle:{color:b.legendColor}}),d=new google.visualization.BarChart(b.el),d.draw(c,e)},linechart:function(b,c){{var d,e,f=a.each;a.extend}e={title:b.title||"",width:parseInt(b.width),height:parseInt(b.height)},f(["backgroundColor","pieSliceBorderColor","colors"],function(a){a in b&&(e[a]=b[a])}),"titleTextColor"in b&&(e.titleTextStyle={color:b.titleTextColor}),"legendColor"in b&&(e.legend={textStyle:{color:b.legendColor}}),d=new google.visualization.LineChart(b.el),d.draw(c,e)}}})}(chartstack),function(a){a.addRenderSet({name:"NVD3",namespace:"nv",adapter:{piechart:function(b){b=b.data;var c=[];return b.shift(),a.each(b,function(a){var b={label:a[0],value:a[1]};c.push(b)}),c},barchart:function(b){b=b.data;var c=a.each,d=[],e=b.shift(),f=e.shift();return c(e,function(a){d.push({key:a,values:[]})}),c(b,function(a){var b=a.shift();c(a,function(a,c){d[c].values.push({x:b,y:a})})}),{result:d,options:{rowDescription:f}}},linechart:function(b){b=b.data;var c=a.each,d=[],e=b.shift(),f=e.shift();return c(e,function(a){d.push({key:a,values:[]})}),c(b,function(a){var b=a.shift();c(a,function(a,c){d[c].values.push([b,a])})}),{result:d,options:{rowDescription:f}}}},render:{init:function(b){b.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),a.each(["width","height"],function(a){var c=parseInt(b[a]);b[a]=c,b.svg.setAttributeNS(null,a,c)}),b.el.appendChild(b.svg)},piechart:function(a,b){nv.addGraph(function(){var c=nv.models.pieChart().x(function(a){return a.label}).y(function(a){return a.value}).showLabels(a.labels);return"colors"in a&&c.color(a.colors),d3.select(a.svg).datum(b).transition().duration(350).call(c),c})},barchart:function(a,b){nv.addGraph(function(){var c=nv.models.multiBarChart();c.width(a.width).height(a.height),c.xAxis.tickFormat(b.result[0].values[0].x instanceof Date?function(a){return d3.time.format("%b %d")(new Date(a))}:d3.format("f")),"colors"in a&&c.color(a.colors),c.yAxis.tickFormat(d3.format(",f")),d3.select(a.svg).datum(b.result).transition().duration(500).call(c),nv.utils.windowResize(c.update)})},linechart:function(a,b){var c=nv.models.lineChart().x(function(a){return a[0]}).y(function(a){return a[1]}).color(d3.scale.category10().range()).useInteractiveGuideline(!0);return c.xAxis.tickFormat(b.result[0].values[0][0]instanceof Date?function(a){return d3.time.format("%b %d")(new Date(a))}:d3.format("f")),"colors"in a&&c.color(a.colors),c.yAxis.tickFormat(d3.format(",g")),d3.select(a.svg).datum(b.result).call(c),c.width(a.width).height(a.height).update(),nv.utils.windowResize(c.update),c}}})}(chartstack),function(a){a.addRenderSet({name:"Highcharts",namespace:"Highcharts",adapter:{piechart:function(a){a=a.data;var b=a.shift();return{type:"pie",name:b.join(" "),data:a}},barchart:function(b){b=b.data;var c=a.each,d=[],e=b.shift(),f=e.shift(),g=[];return c(e,function(a){d.push({name:a,data:[]})}),c(b,function(a){g.push(a.shift()),c(a,function(a,b){d[b].data.push(a)})}),{result:d,options:{categories:g,rowDescription:f}}},linechart:function(b){b=b.data;var c=a.each,d=[],e=b.shift(),f=e.shift(),g=[];return c(e,function(a){d.push({name:a,data:[]})}),c(b,function(a){g.push(a.shift()),c(a,function(a,b){d[b].data.push(a)})}),{result:d,options:{categories:g,rowDescription:f}}}},render:{piechart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||""},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",formatter:function(){return"<b>"+this.point.name+"</b>: "+this.percentage+" %"}}}},series:[b]})},barchart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"bar",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||""},xAxis:{title:{text:b.options.rowDescription},labels:{},categories:b.options.categories},yAxis:{min:0,title:{align:"high"},labels:{overflow:"justify"}},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:100,floating:!0,borderWidth:1,backgroundColor:"#FFFFFF",shadow:!0},credits:{enabled:!1},series:b.result})},linechart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"line",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||"",x:-20},xAxis:{categories:b.options.categories,title:{text:b.options.rowDescription}},yAxis:{title:{},plotLines:[{value:0,width:1,color:"#808080"}]},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:b.result})}}})}(chartstack);
//# sourceMappingURL=chartstack.min.map