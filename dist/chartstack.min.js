/*! chartstack 2014-04-09 */

!function(a){function b(a,b){return a=typeof a,b?a==b:"undefined"!=a}function c(a,c,d){var e;if(!a)return 0;if(d=d?d:a,b(a.length)){for(e=0;e<a.length;e++)if(c.call(d,a[e],e,a)===!1)return 0}else for(e in a)if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1)return 0;return 1}function d(a,b){return c(b,function(b,c){a[c]=b}),a}function e(){return a.chartstack=y,this}function f(a){x?a():A.push(a)}function g(){if(z.defaults.library)z.library=z.defaults.library;else{if(c(Object.keys(z.renderers),function(a){return a in window?(z.library=a,!1):void 0}),!z.library)throw new Error("No charting library located.");z.parse(),x=!0,c(A,function(a){a()})}}function h(){var a=document.querySelectorAll("piechart,barchart,linechart");c(a,function(a){a.getAttribute("datasource")&&new t(a)})}function i(a,b){var c,d=function(){var a;if(window.ActiveXObject)try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){console.warn(b.message),a=null}else a=new XMLHttpRequest;return a};c=d(),c.onreadystatechange=function(){4===c.readyState&&b(c.responseText)},c.open("GET",a,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send()}function j(a){var b,d=a.nodeName?a:document.querySelector(a);if(d)return c(z.charts,function(a){return d==a.el?(b=a,!1):void 0}),b;throw"That element doesn't exist on the page."}function k(a,b){z.is(b,"function")?q[a]=b:c(b,function(b,c){q[a]||(q[a]={}),q[a][c]=b})}function l(a,b){c(b,function(b,c){r[a]||(r[a]={}),r[a][c]=b})}function m(a){var b=(a.name,a.namespace);z.addRenderer(b,a.render),z.addAdapter(b,a.adapter)}function n(a,b){w[a]=b}function o(a){var b=[];for(var c in a)if(a[c]){var d=a[c];"[object String]"!==Object.prototype.toString.call(d)&&(d=JSON.stringify(d)),d=encodeURIComponent(d),b.push(c+"="+d)}return"?"+b.join("&")}function p(a){for(var b,c={},d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=function(a){return decodeURIComponent(a.replace(d," "))},g=a.split("?")[1];b=e.exec(g);)c[f(b[1])]=f(b[2]);return c}var q,r,s,t,u,v,w,x,y=a.chartstack,z=a.chartstack={},A=[];z.adapters=q={},z.renderers=r={},z.charts=s=[],z.transformers=w={json:function(a){return"string"==typeof a?JSON.parse(a):a}},d(z,{noConflict:e,parse:h,is:b,each:c,extend:d,getAjax:i,ready:f,get:j,addAdapter:k,addRenderer:l,addRenderSet:m,addtransformer:n}),z.defaults={labels:!0},z.DataAdapter=u=function(){},z.Event=v=function(){this.allEvents={}},d(v.prototype,{on:function(a,b){a in this.allEvents||(this.allEvents[a]=[]),this.allEvents[a].push(b)},off:function(a,b){if(a||b||(this.allEvents={}),b){var c=this.allEvents[a].indexOf(b);c&&this.allEvents[a].splice(c,1)}else delete this.allEvents[a]},trigger:function(a){var b=this,c=Array.prototype.slice.call(arguments,0);c.shift(),a in this.allEvents&&this.allEvents[a].forEach(function(a){a.apply(b,c)})}}),z.DataResource=function(a){if("string"==typeof a)a.match(/^({|\[)/)?this.response=JSON.parse(a):this.url=a;else for(var b in a)this[b]=a[b];this.configure()},z.DataResource.prototype={configure:function(){return void 0!==this.url&&-1!==this.url.indexOf("?")&&void 0==this.params&&(this.params=p(this.url),this.url=this.url.split("?")[0]),console.log("New Resource",this),this},get:function(a){return this.params[a]||null},set:function(a){for(var b in a)this.params[b]=a[b];return this}},z.Dataset=function(a){var b=[],a=a||{};a instanceof Array?c(a,function(a){b.push(new z.DataResource(a))}):b.push(new z.DataResource(a)),this.resources=b},z.Dataset.prototype={fetch:function(){var a=this,b=[],d=0,e=function(c,e){b[e]=JSON.parse(c),q["keen-io"].call(a.resources[e],b[e]),d++,d==a.resources.length&&console.log("complete",b)},f=function(){console.log("error")};return c(a.resources,function(a,b){var c=a.url+o(a.params),d=function(a){e(a,b)};z.getAjax(c,d,f)}),a},at:function(a){return this.resources[a]||null}},z.Chart=t=function(a){function e(){var d,e,f;d=function(){g.el=a,g.chartType=g.el.nodeName.toLocaleLowerCase(),g.el.style.display="inline-block"},e=function(){g.el=a.el,g.chartType=a.chartType},c(z.defaults,function(a,b){g[b]=a}),"nodeType"in a?d():e(),c([["provider","domain"],"datasource","dataformat","library","labels","width","height","title","titleTextColor","legendColor","colors","pieSliceBorderColor","pieSliceTextColor","backgroundColor","customOptions","formatRowLabel"],function(c){var d,e;b(c,"object")&&(e=c[1],c=c[0]),d=a.nodeType?a.getAttribute(c):a[c],d&&("false"==d||"0"==d||"off"==d?d=!1:("true"==d||"1"==d||"on"==d)&&(d=!0),e?g[e]=d:g[c]=d)}),g.library||(g.library=z.library),g.dataformat||(g.dataformat="json"),r[g.library]&&r[g.library].init&&r[g.library].init(g),"string"==typeof g.datasource&&(g.dataset=new z.Dataset(g.datasource),g.datasource.match(/^({|\[)/)?g.datasource=JSON.parse(g.datasource):(f=g.datasource.match(/\/\/(.*?)\//),f&&(g.domain=f[1])))}function f(a){function b(b){if(!(g.dataformat in w))throw new Error("Transformer for datatype missing: "+g.dataformat);b=w[g.dataformat](b),q[g.domain]&&q[g.domain][g.chartType]&&(b=q[g.domain][g.chartType].call(new u,b)),g.formatRowLabel&&z.each(b.data,function(a,c){0!=c&&(b.data[c][0]=g.formatRowLabel(a[0]))}),b=z.is(q[g.library],"function")?q[g.library].call(new u,b):q[g.library][g.chartType].call(new u,b),a(b)}"string"==typeof g.datasource?z.getAjax(g.datasource,b):b(g.datasource)}var g=this;z.charts.push(this),e(),f(function(a){var b=z.renderers[g.library];if(!b)throw"Renderer for "+g.library+" is missing.";if(!b[g.chartType])throw"Renderer for "+g.library+":"+g.chartType+" is missing.";b[g.chartType](g,a)}),d(g,{show:function(){g.trigger("show")},hide:function(){g.trigger("hide")},draw:function(){g.trigger("draw")},fetch:function(a){a||(a=function(){}),f(a)}})},t.prototype=new z.Event,window.google?(google.load("visualization","1.0",{packages:["corechart"]}),google.setOnLoadCallback(g)):document.addEventListener("DOMContentLoaded",g)}(this),function(a){function b(){var a=[],b=function(){var c=arguments[0],e=Array.prototype.slice.call(arguments,1),f=e.pop();return 0===e.length&&(c instanceof Array?e=c:"object"==typeof c&&e.push(c)),d(e,function(g){return g[f]||0==g[f]||void 0!==g[f]?a.push(null===g[f]?"":g[f]):c[g]?c[g]instanceof Array?void d(c[g],function(a,d){var h=[c[g]].concat(c[g][d]).concat(e.slice(1)).concat(f);return b.apply(this,h)}):c[g][f]?a.push(c[g][f]):b.apply(this,[c[g]].concat(e.splice(1)).concat(f)):b.apply(this,[g].concat(e.splice(1)).concat(f))}),a.length>0?a:void 0};return b.apply(this,arguments)}console.log("hereereerer");var c,d=chartstack.each;a.dataform=function(a,b){this.build(a,b)},c=a.dataform.prototype,c.build=function(a,c){var e=this,f=a[c.root];if(e.map=c,e.table=[],e.series=[],e.raw=a,e.cols=function(){var a=e.map.each.index.split(" -> "),b=e.map.each.value.split(" -> "),c={fixed:[a[a.length-1]]};return e.map.each.label?c.cells=e.map.each.label:c.fixed.push(b[b.length-1]),c}(),e.rows={index:e.map.each.index.split(" -> "),cells:e.map.each.value.split(" -> ")},e.order={rows:["date","asc"],cols:["number","desc"]},e.order.rows.length>0&&f.sort(function(a,c){var d=b.apply(e,[a].concat(e.rows.index)),f=b.apply(e,[c].concat(e.rows.index));return"asc"==e.order.rows[1]?d>f?1:f>d?-1:0:d>f?-1:f>d?1:0}),function(){e.cols.label=e.cols.fixed?e.cols.fixed[0]:"series";var a=e.cols.fixed?e.cols.fixed:[],c=e.cols.cells?b.apply(e,[f[0]].concat(e.cols.cells)):[],g=a.concat(c);g.splice(0,1),d(g,function(a){e.series.push({key:a,values:[]})})}(),d(f,function(a){var c=b.apply(e,[a].concat(e.rows.index)),f=b.apply(e,[a].concat(e.rows.cells));d(f,function(a,b){var d={};d[e.cols.label]=c[0],d.value=a,e.series[b].values.push(d)})}),e.order.cols.length>0&&(e.series=e.series.sort(function(a,b){var c=0,f=0;return d(a.values,function(a){c+=a.value}),d(b.values,function(a){f+=a.value}),"asc"==e.order.cols[1]?c-f:f-c})),e.table=[],e.table.push([e.cols.label]),d(e.series[0].values,function(a){e.table.push([a[e.cols.label]])}),d(e.series,function(a){e.table[0].push(a.key),d(a.values,function(a,b){e.table[b+1].push(a.value)})}),setup.cols.transform)for(var g in setup.cols.transform)"all"==g?d(e.table[0],function(a,b){b>0&&(e.table[0][b]=setup.cols.transform[g](e.table[0][b]))}):(g=parseInt(g),e.table[0].length>g&&(e.table[0][g]=setup.cols.transform[g](e.table[0][g])));return setup.rows.transform&&d(e.table,function(a,b){if(b>0)for(var c in setup.rows.transform)e.table[b][c]=setup.rows.transform[c](e.table[b][c])}),this}}(chartstack),function(a){a.addAdapter("keen-io",function(b){var c,d=this.map||!1;return console.log("map",d),d?(c=new a.dataform(b,d),{data:c.table,extras:{}}):void 0}),a.addAdapter("api.keen.io",{piechart:function(b){return b=new a.diver(b.result,{cols:{fixed:["Browser","Share"]},rows:{index:"platform",cells:"result"}}),{data:b.table,extras:{}}},barchart:function(b){return b=new a.diver(b.result,{cols:{fixed:["Date"],cells:"value -> platform"},rows:{index:"timeframe -> start",cells:"value -> result",transform:{0:function(a){return new Date(a)}}}}),{data:b.table,extras:{}}},linechart:function(b){var c;return c=b.result[0].value instanceof Array?{cols:{fixed:["Date"],cells:"value -> platform"},rows:{index:"timeframe -> start",cells:"value -> result",transform:{0:function(a){return new Date(a)}}}}:{cols:{fixed:["Date","Value"]},rows:{index:"timeframe -> start",cells:"value",transform:{0:function(a){return new Date(a)}}}},b=new a.diver(b.result,c),{data:b.table,extras:{}}}})}(chartstack),function(a){a.addRenderSet({name:"Google Charts",namespace:"google",adapter:function(a){return google.visualization.arrayToDataTable(a.data)},render:{piechart:function(b,c){var d,e,f=a.each,g=a.extend;e={title:b.title||"",width:parseInt(b.width),height:parseInt(b.height)},b.customOptions&&g(e,b.customOptions),f(["backgroundColor","pieSliceBorderColor","colors"],function(a){a in b&&(e[a]=b[a])}),"pieSliceTextColor"in b&&(e.pieSliceTextStyle={color:b.pieSliceTextColor}),"titleTextColor"in b&&(e.titleTextStyle={color:b.titleTextColor}),"legendColor"in b&&(e.legend={textStyle:{color:b.legendColor}}),d=new google.visualization.PieChart(b.el),d.draw(c,e)},barchart:function(b,c){{var d,e,f=a.each;a.extend}e={title:b.title||"",width:parseInt(b.width),height:parseInt(b.height)},f(["backgroundColor","pieSliceBorderColor","colors"],function(a){a in b&&(e[a]=b[a])}),"titleTextColor"in b&&(e.titleTextStyle={color:b.titleTextColor}),"legendColor"in b&&(e.legend={textStyle:{color:b.legendColor}}),d=new google.visualization.BarChart(b.el),d.draw(c,e)},linechart:function(b,c){{var d,e,f=a.each;a.extend}e={title:b.title||"",width:parseInt(b.width),height:parseInt(b.height)},f(["backgroundColor","pieSliceBorderColor","colors"],function(a){a in b&&(e[a]=b[a])}),"titleTextColor"in b&&(e.titleTextStyle={color:b.titleTextColor}),"legendColor"in b&&(e.legend={textStyle:{color:b.legendColor}}),d=new google.visualization.LineChart(b.el),d.draw(c,e)}}})}(chartstack),function(a){a.addRenderSet({name:"NVD3",namespace:"nv",adapter:{piechart:function(b){b=b.data;var c=[];return b.shift(),a.each(b,function(a){var b={label:a[0],value:a[1]};c.push(b)}),c},barchart:function(b){b=b.data;var c=a.each,d=[],e=b.shift(),f=e.shift();return c(e,function(a){d.push({key:a,values:[]})}),c(b,function(a){var b=a.shift();c(a,function(a,c){d[c].values.push({x:b,y:a})})}),{result:d,options:{rowDescription:f}}},linechart:function(b){b=b.data;var c=a.each,d=[],e=b.shift(),f=e.shift();return c(e,function(a){d.push({key:a,values:[]})}),c(b,function(a){var b=a.shift();c(a,function(a,c){d[c].values.push([b,a])})}),{result:d,options:{rowDescription:f}}}},render:{init:function(b){b.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),a.each(["width","height"],function(a){var c=parseInt(b[a]);b[a]=c,b.svg.setAttributeNS(null,a,c)}),b.el.appendChild(b.svg)},piechart:function(a,b){nv.addGraph(function(){var c=nv.models.pieChart().x(function(a){return a.label}).y(function(a){return a.value}).showLabels(a.labels);return"colors"in a&&c.color(a.colors),d3.select(a.svg).datum(b).transition().duration(350).call(c),c})},barchart:function(a,b){nv.addGraph(function(){var c=nv.models.multiBarChart();c.width(a.width).height(a.height),c.xAxis.tickFormat(b.result[0].values[0].x instanceof Date?function(a){return d3.time.format("%b %d")(new Date(a))}:d3.format("f")),"colors"in a&&c.color(a.colors),c.yAxis.tickFormat(d3.format(",f")),d3.select(a.svg).datum(b.result).transition().duration(500).call(c),nv.utils.windowResize(c.update)})},linechart:function(a,b){var c=nv.models.lineChart().x(function(a){return a[0]}).y(function(a){return a[1]}).color(d3.scale.category10().range()).useInteractiveGuideline(!0);return c.xAxis.tickFormat(b.result[0].values[0][0]instanceof Date?function(a){return d3.time.format("%b %d")(new Date(a))}:d3.format("f")),"colors"in a&&c.color(a.colors),c.yAxis.tickFormat(d3.format(",g")),d3.select(a.svg).datum(b.result).call(c),c.width(a.width).height(a.height).update(),nv.utils.windowResize(c.update),c}}})}(chartstack),function(a){a.addRenderSet({name:"Highcharts",namespace:"Highcharts",adapter:{piechart:function(a){a=a.data;var b=a.shift();return{type:"pie",name:b.join(" "),data:a}},barchart:function(b){b=b.data;var c=a.each,d=[],e=b.shift(),f=e.shift(),g=[];return c(e,function(a){d.push({name:a,data:[]})}),c(b,function(a){g.push(a.shift()),c(a,function(a,b){d[b].data.push(a)})}),{result:d,options:{categories:g,rowDescription:f}}},linechart:function(b){b=b.data;var c=a.each,d=[],e=b.shift(),f=e.shift(),g=[];return c(e,function(a){d.push({name:a,data:[]})}),c(b,function(a){g.push(a.shift()),c(a,function(a,b){d[b].data.push(a)})}),{result:d,options:{categories:g,rowDescription:f}}}},render:{piechart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||""},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",formatter:function(){return"<b>"+this.point.name+"</b>: "+this.percentage+" %"}}}},series:[b]})},barchart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"bar",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||""},xAxis:{title:{text:b.options.rowDescription},labels:{},categories:b.options.categories},yAxis:{min:0,title:{align:"high"},labels:{overflow:"justify"}},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:100,floating:!0,borderWidth:1,backgroundColor:"#FFFFFF",shadow:!0},credits:{enabled:!1},series:b.result})},linechart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"line",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||"",x:-20},xAxis:{categories:b.options.categories,title:{text:b.options.rowDescription}},yAxis:{title:{},plotLines:[{value:0,width:1,color:"#808080"}]},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:b.result})}}})}(chartstack);
//# sourceMappingURL=chartstack.min.map