/*! chartstack 2014-03-27 */
!function(a){function b(a,b){return a=typeof a,b?a==b:"undefined"!=a}function c(a,c,d){var e;if(!a)return 0;if(d=d?d:a,b(a.length)){for(e=0;e<a.length;e++)if(c.call(d,a[e],e,a)===!1)return 0}else for(e in a)if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1)return 0;return 1}function d(a,b){return c(b,function(b,c){a[c]=b}),a}function e(a){p?a():q.push(a)}function f(){if(a.defaults.library)a.library=a.defaults.library;else{if(c(Object.keys(a.renderers),function(b){return b in window?(a.library=b,!1):void 0}),!a.library)throw new Error("No charting library located.");a.parse(),p=!0,c(q,function(a){a()})}}function g(){var a=document.querySelectorAll("piechart,barchart,linechart");c(a,function(a){a.getAttribute("datasource")&&new o(a)})}function h(a,b){var c,d=function(){var a;if(window.ActiveXObject)try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){console.warn(b.message),a=null}else a=new XMLHttpRequest;return a};c=d(),c.onreadystatechange=function(){4===c.readyState&&b(JSON.parse(c.responseText))},c.open("GET",a,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send()}function i(b){var d,e=b.nodeName?b:document.querySelector(b);if(e)return c(a.charts,function(a){return e==a.el?(d=a,!1):void 0}),d;throw"That element doesn't exist on the page."}function j(a,b){c(b,function(b,c){l[a]||(l[a]={}),l[a][c]=b})}function k(a,b){c(b,function(b,c){m[a]||(m[a]={}),m[a][c]=b})}var l,m,n,o,p,q=[];a.adapters=l={},a.renderers=m={},a.charts=n=[],d(a,{parse:g,is:b,each:c,extend:d,getJSON:h,ready:e,get:i,addAdapter:j,addRenderer:k}),a.defaults={labels:!0},a.Chart=o=function(e){function f(){var d,f,g;d=function(){h.el=e,h.chartType=h.el.nodeName.toLocaleLowerCase(),h.el.style.display="inline-block"},f=function(){h.el=e.el,h.chartType=e.chartType},c(a.defaults,function(a,b){h[b]=a}),"nodeType"in e?d():f(),c([["provider","domain"],"datasource","library","labels","width","height","title"],function(a){var c,d;b(a,"object")&&(d=a[1],a=a[0]),c=e.nodeType?e.getAttribute(a):e[a],c&&("false"==c||"0"==c||"off"==c?c=!1:("true"==c||"1"==c||"on"==c)&&(c=!0),d?h[d]=c:h[a]=c)}),h.library||(h.library=a.library),m[h.library]&&m[h.library].init&&m[h.library].init(h),h.datasource.match(/^({|\[)/)?h.datasource=JSON.parse(h.datasource):(g=h.datasource.match(/\/\/(.*?)\//),g&&(h.domain=g[1]))}function g(b){function c(a){l[h.domain]&&l[h.domain][h.chartType]&&(a=l[h.domain][h.chartType](a)),a=l[h.library][h.chartType](a),b(a)}"string"==typeof h.datasource?a.getJSON(h.datasource,c):c(h.datasource)}var h=this;a.charts.push(this),f(),g(function(b){var c=a.renderers[h.library];if(!c)throw"Renderer for "+h.library+" is missing.";if(!c[h.chartType])throw"Renderer for "+h.library+":"+h.chartType+" is missing.";c[h.chartType](h,b)}),d(this,{show:function(){this.el.style.display="none"},hide:function(){this.el.style.display="block"},render:function(){},fetch:function(a){a||(a=function(){}),g(a)}})},window.google?(google.load("visualization","1.0",{packages:["corechart"]}),google.setOnLoadCallback(f)):document.addEventListener("DOMContentLoaded",f),window.chartstack=a}({}),function(){function a(a){a=a.result;var b,c,d=a[0].timeframe?1:0,e=a[0].value instanceof Array?1:0,f=[],g=chartstack.each;return d?(b=["date"],e?(c=Object.keys(a[0].value[0])[0],g(a[0].value,function(a){var d=a[c];b.push(d)}),g(a,function(a){var b=[],c=new Date(a.timeframe.start);b.push(c),g(a.value,function(a){b.push(a.result)}),f.push(b)})):(b.push("value"),g(a,function(a){f.push([new Date(a.timeframe.start),a.value])}))):(b=Object.keys(a[0]),g(a,function(a){var c=[a[b[0]],a[b[1]]];f.push(c)})),f.unshift(b),f}chartstack.addAdapter("api.keen.io",{piechart:function(b){return a(b)},barchart:function(b){return a(b)},linechart:function(b){return a(b)}})}(),chartstack.addAdapter("nv",{piechart:function(a){var b=[];return a.shift(),chartstack.each(a,function(a){var c={label:a[0],value:a[1]};b.push(c)}),b},barchart:function(a){var b=chartstack.each,c=[],d=a.shift(),e=d.shift();return b(d,function(a){c.push({key:a,values:[]})}),b(a,function(a){var d=a.shift();b(a,function(a,b){c[b].values.push({x:d,y:a})})}),{result:c,options:{rowDescription:e}}},linechart:function(a){var b=chartstack.each,c=[],d=a.shift(),e=d.shift();return b(d,function(a){c.push({key:a,values:[]})}),b(a,function(a){var d=a.shift();b(a,function(a,b){c[b].values.push([d,a])})}),{result:c,options:{rowDescription:e}}}}),chartstack.addRenderer("nv",{init:function(a){a.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),chartstack.each(["width","height"],function(b){var c=parseInt(a[b]);a[b]=c,a.svg.setAttributeNS(null,b,c)}),a.el.appendChild(a.svg)},piechart:function(a,b){nv.addGraph(function(){var c=nv.models.pieChart().x(function(a){return a.label}).y(function(a){return a.value}).showLabels(a.labels);return d3.select(a.svg).datum(b).transition().duration(350).call(c),c})},barchart:function(a,b){nv.addGraph(function(){var c=nv.models.multiBarChart();c.width(a.width).height(a.height),c.xAxis.tickFormat(b.result[0].values[0].x instanceof Date?function(a){return d3.time.format("%b %d")(new Date(a))}:d3.format("f")),c.yAxis.tickFormat(d3.format(",f")),d3.select(a.svg).datum(b.result).transition().duration(500).call(c),nv.utils.windowResize(c.update)})},linechart:function(a,b){var c=nv.models.lineChart().x(function(a){return a[0]}).y(function(a){return a[1]}).color(d3.scale.category10().range()).useInteractiveGuideline(!0);return c.width(a.width).height(a.height),c.xAxis.tickFormat(b.result[0].values[0][0]instanceof Date?function(a){return d3.time.format("%b %d")(new Date(a))}:d3.format("f")),c.yAxis.tickFormat(d3.format(",g")),d3.select(a.svg).datum(b.result).call(c),nv.utils.windowResize(c.update),c}}),chartstack.addAdapter("google",{piechart:function(a){return google.visualization.arrayToDataTable(a)},barchart:function(a){return google.visualization.arrayToDataTable(a)},linechart:function(a){return google.visualization.arrayToDataTable(a)}}),chartstack.addRenderer("google",{piechart:function(a,b){var c,d;d={title:a.title||"",width:parseInt(a.width),height:parseInt(a.height)},c=new google.visualization.PieChart(a.el),c.draw(b,d)},barchart:function(a,b){var c,d;d={title:a.title||""},c=new google.visualization.BarChart(a.el),c.draw(b,d)},linechart:function(a,b){var c,d;d={title:a.title||""},c=new google.visualization.LineChart(a.el),c.draw(b,d)}}),chartstack.addAdapter("Highcharts",{piechart:function(a){var b=a.shift();return{type:"pie",name:b.join(" "),data:a}},barchart:function(a){var b=chartstack.each,c=[],d=a.shift(),e=d.shift(),f=[];return b(d,function(a){c.push({name:a,data:[]})}),b(a,function(a){f.push(a.shift()),b(a,function(a,b){c[b].data.push(a)})}),{result:c,options:{categories:f,rowDescription:e}}},linechart:function(a){var b=chartstack.each,c=[],d=a.shift(),e=d.shift(),f=[];return b(d,function(a){c.push({name:a,data:[]})}),b(a,function(a){f.push(a.shift()),b(a,function(a,b){c[b].data.push(a)})}),{result:c,options:{categories:f,rowDescription:e}}}}),chartstack.addRenderer("Highcharts",{piechart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||""},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",formatter:function(){return"<b>"+this.point.name+"</b>: "+this.percentage+" %"}}}},series:[b]})},barchart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"bar",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||""},xAxis:{title:{text:b.options.rowDescription},labels:{},categories:b.options.categories},yAxis:{min:0,title:{align:"high"},labels:{overflow:"justify"}},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:100,floating:!0,borderWidth:1,backgroundColor:"#FFFFFF",shadow:!0},credits:{enabled:!1},series:b.result})},linechart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"line",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||"",x:-20},xAxis:{categories:b.options.categories,title:{text:b.options.rowDescription}},yAxis:{title:{},plotLines:[{value:0,width:1,color:"#808080"}]},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:b.result})}});