/*! chartstack 2014-04-01 */

!function(a){function b(a,b){return a=typeof a,b?a==b:"undefined"!=a}function c(a,c,d){var e;if(!a)return 0;if(d=d?d:a,b(a.length)){for(e=0;e<a.length;e++)if(c.call(d,a[e],e,a)===!1)return 0}else for(e in a)if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1)return 0;return 1}function d(a,b){return c(b,function(b,c){a[c]=b}),a}function e(a){s?a():t.push(a)}function f(){if(a.defaults.library)a.library=a.defaults.library;else{if(c(Object.keys(a.renderers),function(b){return b in window?(a.library=b,!1):void 0}),!a.library)throw new Error("No charting library located.");a.parse(),s=!0,c(t,function(a){a()})}}function g(){var a=document.querySelectorAll("piechart,barchart,linechart");c(a,function(a){a.getAttribute("datasource")&&new p(a)})}function h(a,b){var c,d=function(){var a;if(window.ActiveXObject)try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){console.warn(b.message),a=null}else a=new XMLHttpRequest;return a};c=d(),c.onreadystatechange=function(){4===c.readyState&&b(c.responseText)},c.open("GET",a,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send()}function i(b){var d,e=b.nodeName?b:document.querySelector(b);if(e)return c(a.charts,function(a){return e==a.el?(d=a,!1):void 0}),d;throw"That element doesn't exist on the page."}function j(a,b){c(b,function(b,c){m[a]||(m[a]={}),m[a][c]=b})}function k(a,b){c(b,function(b,c){n[a]||(n[a]={}),n[a][c]=b})}function l(a,b){r[a]=b}var m,n,o,p,q,r,s,t=[];a.adapters=m={},a.renderers=n={},a.charts=o=[],a.transformers=r={json:function(a){return"string"==typeof a?JSON.parse(a):a}},d(a,{parse:g,is:b,each:c,extend:d,getAjax:h,ready:e,get:i,addAdapter:j,addRenderer:k,addtransformer:l}),a.defaults={labels:!0},a.DataAdapter=q=function(){},a.Chart=p=function(e){function f(){var d,f,g;d=function(){h.el=e,h.chartType=h.el.nodeName.toLocaleLowerCase(),h.el.style.display="inline-block"},f=function(){h.el=e.el,h.chartType=e.chartType},c(a.defaults,function(a,b){h[b]=a}),"nodeType"in e?d():f(),c([["provider","domain"],"datasource","dataformat","library","labels","width","height","title","titleTextColor","legendColor","colors","pieSliceBorderColor","pieSliceTextColor","backgroundColor","customOptions"],function(a){var c,d;b(a,"object")&&(d=a[1],a=a[0]),c=e.nodeType?e.getAttribute(a):e[a],c&&("false"==c||"0"==c||"off"==c?c=!1:("true"==c||"1"==c||"on"==c)&&(c=!0),d?h[d]=c:h[a]=c)}),h.library||(h.library=a.library),h.dataformat||(h.dataformat="json"),n[h.library]&&n[h.library].init&&n[h.library].init(h),"string"==typeof h.datasource&&(h.datasource.match(/^({|\[)/)?h.datasource=JSON.parse(h.datasource):(g=h.datasource.match(/\/\/(.*?)\//),g&&(h.domain=g[1])))}function g(b){function c(a){if(!(h.dataformat in r))throw new Error("Transformer for datatype missing: "+h.dataformat);a=r[h.dataformat](a),m[h.domain]&&m[h.domain][h.chartType]&&(a=m[h.domain][h.chartType].call(new q,a)),a=m[h.library][h.chartType].call(new q,a),b(a)}"string"==typeof h.datasource?a.getAjax(h.datasource,c):c(h.datasource)}var h=this;a.charts.push(this),f(),g(function(b){var c=a.renderers[h.library];if(!c)throw"Renderer for "+h.library+" is missing.";if(!c[h.chartType])throw"Renderer for "+h.library+":"+h.chartType+" is missing.";c[h.chartType](h,b)}),d(this,{show:function(){this.el.style.display="none"},hide:function(){this.el.style.display="block"},render:function(){},fetch:function(a){a||(a=function(){}),g(a)}})},window.google?(google.load("visualization","1.0",{packages:["corechart"]}),google.setOnLoadCallback(f)):document.addEventListener("DOMContentLoaded",f),window.chartstack=a}({}),function(a){function b(){var a=[],b=function(){var c=arguments[0],e=Array.prototype.slice.call(arguments,1),f=e.pop();return 0===e.length&&(c instanceof Array?e=c:"object"==typeof c&&e.push(c)),d(e,function(g){return g[f]||0==g[f]||void 0!==g[f]?a.push(null===g[f]?"":g[f]):c[g]?c[g]instanceof Array?void d(c[g],function(a,d){var h=[c[g]].concat(c[g][d]).concat(e.slice(1)).concat(f);return b.apply(this,h)}):c[g][f]?a.push(c[g][f]):b.apply(this,[c[g]].concat(e.splice(1)).concat(f)):b.apply(this,[g].concat(e.splice(1)).concat(f))}),a.length>0?a:void 0};return b.apply(this,arguments)}var c,d=chartstack.each;a.diver=function(a,b){this.build(a,b)},c=a.diver.prototype,c.build=function(a,c){var e=this;if(e.cols={label:c.cols.label?c.cols.label.split(" -> "):!1,cells:c.cols.cells?c.cols.cells.split(" -> "):!1,fixed:c.cols.fixed?c.cols.fixed:!1},e.rows={index:c.rows.index.split(" -> "),cells:c.rows.cells.split(" -> ")},e.order={rows:c.order&&c.order.rows?c.order.rows.split(":"):!1,cols:c.order&&c.order.cols?c.order.cols.split(":"):!1},e.table=[],e.series=[],e.raw=a,e.order.rows.length>0&&a.sort(function(a,c){var d=b.apply(e,[a].concat(e.rows.index)),f=b.apply(e,[c].concat(e.rows.index));return"asc"==e.order.rows[1]?d>f?1:f>d?-1:0:d>f?-1:f>d?1:0}),function(){e.cols.label=e.cols.fixed?e.cols.fixed[0]:"series";var c=e.cols.fixed?e.cols.fixed:[],f=e.cols.cells?b.apply(e,[a[0]].concat(e.cols.cells)):[],g=c.concat(f);g.splice(0,1),d(g,function(a){e.series.push({key:a,values:[]})})}(),d(a,function(a){var c=b.apply(e,[a].concat(e.rows.index)),f=b.apply(e,[a].concat(e.rows.cells));d(f,function(a,b){var d={};d[e.cols.label]=c[0],d.value=a,e.series[b].values.push(d)})}),e.order.cols.length>0&&(e.series=e.series.sort(function(a,b){var c=0,f=0;return d(a.values,function(a){c+=a.value}),d(b.values,function(a){f+=a.value}),"asc"==e.order.cols[1]?c-f:f-c})),e.table=[],e.table.push([e.cols.label]),d(e.series[0].values,function(a){e.table.push([a[e.cols.label]])}),d(e.series,function(a){e.table[0].push(a.key),d(a.values,function(a,b){e.table[b+1].push(a.value)})}),c.cols.transform)for(var f in c.cols.transform)"all"==f?d(e.table[0],function(a,b){b>0&&(e.table[0][b]=c.cols.transform[f](e.table[0][b]))}):(f=parseInt(f),e.table[0].length>f&&(e.table[0][f]=c.cols.transform[f](e.table[0][f])));return c.rows.transform&&d(e.table,function(a,b){if(b>0)for(var d in c.rows.transform)e.table[b][d]=c.rows.transform[d](e.table[b][d])}),this},c.render=function(a){return"csv"==a&&console.log(this.table.join("\n")),this}}(chartstack),chartstack.addAdapter("api.keen.io",{piechart:function(a){console.log("data",a);var b=new chartstack.diver(a.result,{cols:{fixed:["Browser","Share"]},rows:{index:"platform",cells:"result"}});return{data:b.table,extras:{}}},barchart:function(a){return a=new chartstack.diver(a.result,{cols:{fixed:["Date"],cells:"value -> platform"},rows:{index:"timeframe -> start",cells:"value -> result",transform:{0:function(a){return new Date(a)}}}}),{data:a.table,extras:{}}},linechart:function(a){console.log("data",a);var b;return b=a.result[0].value instanceof Array?{cols:{fixed:["Date"],cells:"value -> platform"},rows:{index:"timeframe -> start",cells:"value -> result",transform:{0:function(a){return new Date(a)}}}}:{cols:{fixed:["Date","Value"]},rows:{index:"timeframe -> start",cells:"value",transform:{0:function(a){return new Date(a)}}}},a=new chartstack.diver(a.result,b),console.log("diver format data",a),{data:a.table,extras:{}}}}),chartstack.addAdapter("nv",{piechart:function(a){a=a.data;var b=[];return a.shift(),chartstack.each(a,function(a){var c={label:a[0],value:a[1]};b.push(c)}),b},barchart:function(a){a=a.data;var b=chartstack.each,c=[],d=a.shift(),e=d.shift();return b(d,function(a){c.push({key:a,values:[]})}),b(a,function(a){var d=a.shift();b(a,function(a,b){c[b].values.push({x:d,y:a})})}),{result:c,options:{rowDescription:e}}},linechart:function(a){a=a.data;var b=chartstack.each,c=[],d=a.shift(),e=d.shift();return b(d,function(a){c.push({key:a,values:[]})}),b(a,function(a){var d=a.shift();b(a,function(a,b){c[b].values.push([d,a])})}),{result:c,options:{rowDescription:e}}}}),chartstack.addRenderer("nv",{init:function(a){a.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),chartstack.each(["width","height"],function(b){var c=parseInt(a[b]);a[b]=c,a.svg.setAttributeNS(null,b,c)}),a.el.appendChild(a.svg)},piechart:function(a,b){nv.addGraph(function(){var c=nv.models.pieChart().x(function(a){return a.label}).y(function(a){return a.value}).showLabels(a.labels);return"colors"in a&&c.color(a.colors),d3.select(a.svg).datum(b).transition().duration(350).call(c),c})},barchart:function(a,b){nv.addGraph(function(){var c=nv.models.multiBarChart();c.width(a.width).height(a.height),c.xAxis.tickFormat(b.result[0].values[0].x instanceof Date?function(a){return d3.time.format("%b %d")(new Date(a))}:d3.format("f")),"colors"in a&&c.color(a.colors),c.yAxis.tickFormat(d3.format(",f")),d3.select(a.svg).datum(b.result).transition().duration(500).call(c),nv.utils.windowResize(c.update)})},linechart:function(a,b){var c=nv.models.lineChart().x(function(a){return a[0]}).y(function(a){return a[1]}).color(d3.scale.category10().range()).useInteractiveGuideline(!0);return c.xAxis.tickFormat(b.result[0].values[0][0]instanceof Date?function(a){return d3.time.format("%b %d")(new Date(a))}:d3.format("f")),"colors"in a&&c.color(a.colors),c.yAxis.tickFormat(d3.format(",g")),d3.select(a.svg).datum(b.result).call(c),c.width(a.width).height(a.height).update(),nv.utils.windowResize(c.update),c}}),chartstack.addAdapter("google",{piechart:function(a){return google.visualization.arrayToDataTable(a.data)},barchart:function(a){return google.visualization.arrayToDataTable(a.data)},linechart:function(a){return google.visualization.arrayToDataTable(a.data)}}),chartstack.addRenderer("google",{piechart:function(a,b){var c,d,e=chartstack.each,f=chartstack.extend;d={title:a.title||"",width:parseInt(a.width),height:parseInt(a.height)},a.customOptions&&f(d,a.customOptions),e(["backgroundColor","pieSliceBorderColor","colors"],function(b){b in a&&(d[b]=a[b])}),"pieSliceTextColor"in a&&(d.pieSliceTextStyle={color:a.pieSliceTextColor}),"titleTextColor"in a&&(d.titleTextStyle={color:a.titleTextColor}),"legendColor"in a&&(d.legend={textStyle:{color:a.legendColor}}),console.log("options",d),c=new google.visualization.PieChart(a.el),c.draw(b,d)},barchart:function(a,b){{var c,d,e=chartstack.each;chartstack.extend}d={title:a.title||"",width:parseInt(a.width),height:parseInt(a.height)},e(["backgroundColor","pieSliceBorderColor","colors"],function(b){b in a&&(d[b]=a[b])}),"titleTextColor"in a&&(d.titleTextStyle={color:a.titleTextColor}),"legendColor"in a&&(d.legend={textStyle:{color:a.legendColor}}),c=new google.visualization.BarChart(a.el),c.draw(b,d)},linechart:function(a,b){{var c,d,e=chartstack.each;chartstack.extend}d={title:a.title||"",width:parseInt(a.width),height:parseInt(a.height)},e(["backgroundColor","pieSliceBorderColor","colors"],function(b){b in a&&(d[b]=a[b])}),"titleTextColor"in a&&(d.titleTextStyle={color:a.titleTextColor}),"legendColor"in a&&(d.legend={textStyle:{color:a.legendColor}}),c=new google.visualization.LineChart(a.el),c.draw(b,d)}}),chartstack.addAdapter("Highcharts",{piechart:function(a){a=a.data;var b=a.shift();return{type:"pie",name:b.join(" "),data:a}},barchart:function(a){a=a.data;var b=chartstack.each,c=[],d=a.shift(),e=d.shift(),f=[];return b(d,function(a){c.push({name:a,data:[]})}),b(a,function(a){f.push(a.shift()),b(a,function(a,b){c[b].data.push(a)})}),{result:c,options:{categories:f,rowDescription:e}}},linechart:function(a){a=a.data;var b=chartstack.each,c=[],d=a.shift(),e=d.shift(),f=[];return b(d,function(a){c.push({name:a,data:[]})}),b(a,function(a){f.push(a.shift()),b(a,function(a,b){c[b].data.push(a)})}),{result:c,options:{categories:f,rowDescription:e}}}}),chartstack.addRenderer("Highcharts",{piechart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||""},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",formatter:function(){return"<b>"+this.point.name+"</b>: "+this.percentage+" %"}}}},series:[b]})},barchart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"bar",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||""},xAxis:{title:{text:b.options.rowDescription},labels:{},categories:b.options.categories},yAxis:{min:0,title:{align:"high"},labels:{overflow:"justify"}},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:100,floating:!0,borderWidth:1,backgroundColor:"#FFFFFF",shadow:!0},credits:{enabled:!1},series:b.result})},linechart:function(a,b){return new Highcharts.Chart({chart:{renderTo:a.el,type:"line",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.title||"",x:-20},xAxis:{categories:b.options.categories,title:{text:b.options.rowDescription}},yAxis:{title:{},plotLines:[{value:0,width:1,color:"#808080"}]},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:b.result})}});
//# sourceMappingURL=chartstack.min.map